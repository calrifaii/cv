<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Phaser Text Cubes Animation</title>

    <script src="https://cdn.jsdelivr.net/npm/phaser@3.85.0/dist/phaser.js"></script>

    <style>
        body {
            margin: 0;
            padding: 0;
            background: #b8ffb8; /* VERT CLAIR */
            display: flex;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }

        #left-panel {
            width: 65vw;
            height: 100vh;
        }

        #right-panel {
            width: 35vw;
            height: 100vh;
            background: #ffffff80;
            padding: 20px;
            box-shadow: -5px 0px 10px #00000030;
        }

        #textInput {
            width: 90%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            margin-bottom: 20px;
        }

        #preview {
            font-size: 22px;
            font-weight: bold;
            color: #ff3eb5;
        }
    </style>
</head>
<body>

<!-- Left: Animation -->
<div id="left-panel"></div>

<!-- Right: Text Input -->
<div id="right-panel">
    <h2>ðŸ©· Animation en cubes</h2>
    <p>Ã‰cris un nom ou une phrase :</p>
    <input id="textInput" type="text" placeholder="Ã‰cris ici..." />

    <p>AperÃ§u :</p>
    <div id="preview"></div>
</div>


<script>
/* ========== LEFT PANEL ANIMATION (Original) ========== */
class MainAnimation extends Phaser.Scene
{
    constructor() {
        super();
        this.phase = 0;
        this.phaseDuration = 6000;
        this.timeSincePhase = 0;
    }

    preload() {
        this.load.setBaseURL('https://cdn.phaserfiles.com/v385');
        this.load.image('square', 'assets/sprites/50x50.png');
        this.load.image('spark', 'assets/particles/blue.png');
    }

    create() {
        this.particles = this.add.particles('spark');

        const blocks = this.add.group();

        for (let i = 0; i < 108; i++) {
            const child = this.add.image(0, 0, 'square').setScale(0.3);
            child.setTint(0xff3eb5); // rose
            blocks.add(child);
        }

        Phaser.Actions.GridAlign(blocks.getChildren(), {
            width: 12, height: 9,
            cellWidth: 60, cellHeight: 60,
            x: 40, y: 40
        });

        this.blocks = blocks;
        this.original = blocks.getChildren().map(b => ({ x: b.x, y: b.y }));
    }

    update(time, delta) {
        this.timeSincePhase += delta;
        if (this.timeSincePhase > this.phaseDuration) {
            this.phase = (this.phase + 1) % 4;
            this.timeSincePhase = 0;
        }

        this.animateBlocks(time);
    }

    animateBlocks(time) {
        const b = this.blocks.getChildren();

        b.forEach((block, i) => {
            const orig = this.original[i];
            let offset = 0;

            switch (this.phase) {
                case 0: offset = Math.sin(time/300 + orig.y*0.12)*12; break;
                case 1:
                    const dx = orig.x-400, dy=orig.y-300;
                    offset = Math.sin(time/250 + Math.sqrt(dx*dx+dy*dy)*0.05)*18;
                    break;
                case 2: offset = Math.sin(time/220 + (orig.x+orig.y)*0.06)*15; break;
                case 3: offset = Math.sin(time/150 + i)*Phaser.Math.Between(8,25); break;
            }

            block.x = orig.x + offset;
        });
    }
}


/* ========== RIGHT PANEL ANIMATION: TEXT IN CUBES ========== */
class TextCubes extends Phaser.Scene
{
    constructor() {
        super({ key: "TextCubes" });
        this.cubes = [];
    }

    preload() {
        this.load.setBaseURL('https://cdn.phaserfiles.com/v385');
        this.load.image('cube', 'assets/sprites/50x50.png');
    }

    create() {
        this.container = this.add.container(50, 150);
        this.inputText = "";

        this.updateText("HELLO");
    }

    updateText(text) {
        this.container.removeAll(true);
        this.cubes = [];

        let x = 0;

        for (let char of text.toUpperCase()) {
            if (char === " ") { x += 40; continue; }

            const cube = this.add.image(x, 0, 'cube').setScale(0.25);
            cube.setTint(0xff3eb5);

            this.tweens.add({
                targets: cube,
                y: { from: 0, to: 20 },
                duration: 600,
                repeat: -1,
                yoyo: true,
                delay: x * 2
            });

            this.container.add(cube);
            x += 35;
        }
    }
}


/* ========== GAME CONFIG ========== */
const game = new Phaser.Game({
    type: Phaser.AUTO,
    width: document.getElementById("left-panel").clientWidth,
    height: window.innerHeight,
    backgroundColor: '#b8ffb8',
    parent: 'left-panel',
    scene: [MainAnimation, TextCubes]
});


/* ========== INPUT LISTENER ========== */
document.getElementById("textInput").addEventListener("input", e => {
    const text = e.target.value;
    document.getElementById("preview").textContent = text;

    const scene = game.scene.keys["TextCubes"];
    scene.updateText(text);
});
</script>

</body>
</html>
