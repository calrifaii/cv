<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <title>Phaser Waves Project</title>

    <!-- Import Phaser -->
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.85.0/dist/phaser.js"></script>

    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            font-family: Arial, sans-serif;
            overflow: hidden;
        }

        #phaser-example {
            width: 100vw;
            height: 100vh;
        }
    </style>
</head>
<body>

<div id="phaser-example"></div>

<script>
// ---------------------------------------------------------
//  COMPLETE JS CODE
// ---------------------------------------------------------

class Example extends Phaser.Scene {
    constructor() {
        super();
        this.phase = 0; 
        this.phaseDuration = 6000; 
        this.timeSincePhase = 0;
    }

    preload() {
        this.load.setBaseURL('https://cdn.phaserfiles.com/v385');

        // Background
        this.load.image('bg', 'assets/tweens/space.png');

        // Shapes
        this.load.image('square', 'assets/sprites/50x50.png');
        this.load.image('circle', 'assets/sprites/blue_ball.png');
        this.load.image('diamond', 'assets/sprites/diamond.png');

        // Particles
        this.load.image('spark', 'assets/particles/blue.png');

        // Sounds
        this.load.audio('pop', 'assets/audio/SoundEffects/pop.wav');
    }

    create() {
        this.add.image(400, 300, 'bg');

        this.particles = this.add.particles('spark');
        this.blocks = this.add.group();

        const shapes = ['square', 'circle', 'diamond'];

        for (let i = 0; i < 108; i++) {
            const shape = shapes[i % shapes.length];
            const block = this.add.image(0, 0, shape).setScale(0.3);

            block.setTint(Phaser.Display.Color.RandomRGB().color);

            // Hover
            block.setInteractive({ pixelPerfect: true });
            block.on('pointerover', () => {
                this.tweens.add({
                    targets: block,
                    scale: 0.5,
                    duration: 150,
                    yoyo: true
                });
            });

            // Click
            block.on('pointerdown', () => {
                this.sound.play('pop', { volume: 0.4 });

                this.particles.createEmitter({
                    x: block.x,
                    y: block.y,
                    speed: { min: -150, max: 150 },
                    lifespan: 500,
                    scale: { start: 0.5, end: 0 },
                    quantity: 25
                });
            });

            this.blocks.add(block);
        }

        // Grid
        Phaser.Actions.GridAlign(this.blocks.getChildren(), {
            width: 12,
            height: 9,
            cellWidth: 60,
            cellHeight: 60,
            x: 40,
            y: 30
        });

        this.originalPositions = this.blocks.getChildren().map(b => ({
            x: b.x,
            y: b.y
        }));
    }

    update(time, delta) {
        this.timeSincePhase += delta;

        if (this.timeSincePhase > this.phaseDuration) {
            this.phase = (this.phase + 1) % 4;
            this.timeSincePhase = 0;

            this.blocks.getChildren().forEach(b =>
                b.setTint(Phaser.Display.Color.RandomRGB().color)
            );
        }

        // Mouse attraction
        if (this.input.activePointer.isDown) {
            const mx = this.input.x;
            const my = this.input.y;

            this.blocks.getChildren().forEach(block => {
                const angle = Phaser.Math.Angle.Between(block.x, block.y, mx, my);
                block.x += Math.cos(angle) * 0.6;
                block.y += Math.sin(angle) * 0.6;
            });
        }

        this.animateBlocks(time);
    }

    animateBlocks(time) {
        const blocks = this.blocks.getChildren();

        blocks.forEach((block, i) => {
            const orig = this.originalPositions[i];
            let offset = 0;

            switch (this.phase) {
                case 0:
                    offset = Math.sin(time / 300 + orig.y * 0.12) * 12;
                    break;

                case 1:
                    const dx = orig.x - 400;
                    const dy = orig.y - 300;
                    const dist = Math.sqrt(dx * dx + dy * dy);
                    offset = Math.sin(time / 250 + dist * 0.05) * 18;
                    break;

                case 2:
                    offset = Math.sin(time / 220 + (orig.x + orig.y) * 0.06) * 15;
                    break;

                case 3:
                    offset = Math.sin(time / 150 + i) * Phaser.Math.Between(8, 25);
                    break;
            }

            block.x = orig.x + offset;
            block.y = orig.y + offset;
        });
    }
}

const config = {
    type: Phaser.AUTO,
    width: window.innerWidth,
    height: window.innerHeight,
    backgroundColor: '#1a1a1a',
    parent: 'phaser-example',
    scene: Example
};

const game = new Phaser.Game(config);

</script>
</body>
</html>
