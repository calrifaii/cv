<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phaser Shapes + Text Generator Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.85.0/dist/phaser.js"></script>

    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            font-family: 'Inter', Arial, sans-serif;
            overflow: hidden;
            background: #e0f7fa;
        }

        #phaser-example {
            width: 70vw;
            height: 100vh;
            border-right: 3px solid #00bcd4;
        }

        #right-panel {
            width: 30vw;
            height: 100vh;
            background: #ffffff;
            padding: 20px;
            box-sizing: border-box;
            overflow: auto;
            display: flex;
            flex-direction: column;
        }

        #right-panel h2 {
            margin-top: 0;
            color: #00bcd4;
            font-size: 24px;
            text-align: center;
            margin-bottom: 20px;
            font-weight: 800;
        }

        #text-input {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            margin-bottom: 15px;
            border: 2px solid #00bcd4;
            border-radius: 10px;
            outline: none;
        }

        #generate-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(45deg, #ff5722, #ff9800);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            cursor: pointer;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .history-section {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .history-title {
            font-size: 14px;
            font-weight: 700;
            color: #ff5722;
            margin-bottom: 10px;
        }

        #history-list {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
            overflow-y: auto;
        }

        .history-item {
            padding: 10px;
            background: rgba(0, 188, 212, 0.08);
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
        }
    </style>
</head>

<body>

<div id="phaser-example"></div>

<div id="right-panel">
    <h2>Générateur d'Animation Pro</h2>
    <input id="text-input" type="text" placeholder="Écris un mot ou une phrase…" maxlength="20">
    <button id="generate-btn">Générer l'animation et la musique</button>

    <div class="history-section">
        <div class="history-title">Historique</div>
        <div id="history-list"></div>
    </div>
</div>

<script>
class Example extends Phaser.Scene {
    constructor() {
        super();
        this.popSound = null;
        this.bgMusic = null;
        this.history = [];
        this.currentAnimationText = '';
    }

    preload() {
        this.load.setBaseURL('https://labs.phaser.io');
        this.load.image('spark', 'assets/particles/blue.png');
        this.load.audio('pop', 'assets/audio/SoundEffects/pop.wav');
        this.load.audio('music', 'assets/audio/oedipus_prefix_bgm.mp3');
    }

    create() {
        this.setupAudio();
        this.createTextEngine();
    }

    setupAudio() {
        try {
            this.popSound = this.sound.add('pop', { volume: 0.4 });
            this.bgMusic = this.sound.add('music', { loop: true, volume: 0.15 });
        } catch (e) {
            console.log('Audio disabled');
        }
    }

    playPop() {
        if (!this.popSound) return;
        try {
            if (this.popSound.isPlaying) this.popSound.stop();
            this.popSound.play();
        } catch (e) {}
    }

    startMusic() {
        if (this.bgMusic && !this.bgMusic.isPlaying) {
            try { this.bgMusic.play(); } catch(e){}
        }
    }

    createTextEngine() {
        const input = document.getElementById("text-input");
        const button = document.getElementById("generate-btn");
        const historyList = document.getElementById("history-list");
        const self = this;

        button.addEventListener("click", function () {
            const text = input.value.trim();
            if (!text) return;

            self.playPop();
            self.startMusic();

            if (!self.history.includes(text)) self.history.push(text);

            historyList.innerHTML = '';
            self.history.forEach(t => {
                const item = document.createElement('div');
                item.className = 'history-item';
                item.innerText = t;
                item.onclick = () => {
                    self.playPop();
                    self.startMusic();
                };
                historyList.appendChild(item);
            });

            input.value = '';
        });
    }
}

new Phaser.Game({
    type: Phaser.AUTO,
    width: window.innerWidth * 0.7,
    height: window.innerHeight,
    parent: 'phaser-example',
    scene: Example
});
</script>

</body>
</html>
