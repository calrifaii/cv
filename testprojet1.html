<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Phaser Shapes + Text + Color Animation</title>
<script src="https://cdn.jsdelivr.net/npm/phaser@3.85.0/dist/phaser.js"></script>
<style>
body { margin:0; padding:0; display:flex; font-family: Arial,sans-serif; overflow:hidden; background:#b8ffb8; }
#phaser-example { width:70vw; height:100vh; }
#right-panel { width:30vw; height:100vh; background:rgba(255,255,255,0.95); padding:20px; box-sizing:border-box; backdrop-filter: blur(5px); overflow:auto; display:flex; flex-direction:column;}
#right-panel h2 { margin-top:0; color:#ff3eb5; font-size:22px; text-align:center; margin-bottom:15px; }
#text-input { width:100%; padding:10px; font-size:16px; margin-bottom:12px; border:2px solid #ff3eb5; border-radius:8px; outline:none; transition:all 0.3s ease; }
#text-input:focus { box-shadow:0 0 10px rgba(255,62,181,0.3); transform:translateY(-2px); }
#generate-btn { width:100%; padding:10px; background:#ff3eb5; color:white; border:none; border-radius:8px; font-size:16px; cursor:pointer; transition:all 0.3s ease; font-weight:600; margin-bottom:15px;}
#generate-btn:hover { transform:translateY(-2px); box-shadow:0 5px 15px rgba(255,62,181,0.3);}
#generate-btn:active { transform:translateY(0);}
.color-picker { display:flex; justify-content:space-between; margin-bottom:15px; }
.color-option { width:50px; height:50px; border-radius:50%; cursor:pointer; border:3px solid transparent; transition: all 0.3s ease; }
.color-option.active { border-color:#000; }
.history-section { flex:1; display:flex; flex-direction:column; margin-top:10px; }
.history-title { font-size:14px; font-weight:700; color:#ff3eb5; text-transform:uppercase; letter-spacing:1px; margin-bottom:10px; }
#history-list { flex:1; display:flex; flex-direction:column; gap:8px; overflow-y:auto; margin-bottom:10px;}
#history-list::-webkit-scrollbar { width:6px; }
#history-list::-webkit-scrollbar-track { background: rgba(255,62,181,0.1); border-radius:10px; }
#history-list::-webkit-scrollbar-thumb { background:#ff3eb5; border-radius:10px; }
.history-item { padding:10px; background:rgba(255,62,181,0.08); border:1px solid rgba(255,62,181,0.2); border-radius:6px; cursor:pointer; transition:all 0.3s ease; font-size:12px; color:#333; word-break:break-word; font-weight:500; }
.history-item:hover { background:rgba(255,62,181,0.15); border-color:#ff3eb5; transform:translateX(3px); }
.history-item.active { background:#ff3eb5; color:white; border-color:#ff3eb5; font-weight:600; }
.clear-history-btn { width:100%; padding:8px; background:rgba(255,62,181,0.1); color:#ff3eb5; border:1px solid #ff3eb5; border-radius:6px; font-size:11px; cursor:pointer; transition:all 0.3s ease; font-weight:600; text-transform:uppercase; letter-spacing:0.5px; }
.clear-history-btn:hover { background:#ff3eb5; color:white; }
</style>
</head>
<body>

<div id="phaser-example"></div>

<div id="right-panel">
  <h2>Créer une animation avec ton texte</h2>
  <input id="text-input" type="text" placeholder="Écris un mot ou une phrase…" maxlength="20">
  <div class="color-picker">
    <div class="color-option" data-color="#FF00AA" style="background:#FF00AA;"></div>
    <div class="color-option" data-color="#00C3FF" style="background:#00C3FF;"></div>
    <div class="color-option" data-color="#40FF00" style="background:#40FF00;"></div>
    <div class="color-option" data-color="#FFD400" style="background:#FFD400;"></div>
    <div class="color-option" data-color="#9933FF" style="background:#9933FF;"></div>
  </div>
  <button id="generate-btn">Générer l'animation</button>

  <div class="history-section">
    <div class="history-title">Historique</div>
    <div id="history-list"></div>
    <button class="clear-history-btn" id="clear-history-btn">Effacer l'historique</button>
  </div>
</div>

<script>
class Example extends Phaser.Scene {
  constructor() {
    super();
    this.phase = 0;
    this.phaseDuration = 6000;
    this.timeSincePhase = 0;
    this.history = [];
    this.currentText = null;
    this.currentColor = '#FF00AA';
    this.blocks = null;
    this.letters = [];
    this.popSound = null;
    this.currentAnimationText = '';
  }

  preload() {
    this.load.setBaseURL('https://labs.phaser.io');
    this.load.image('spark', 'assets/particles/blue.png');
    this.load.audio('pop', 'assets/audio/SoundEffects/pop.wav');
  }

  create() {
    // Load audio
    this.popSound = this.sound.add('pop',{volume:0.5});

    // Graphics for shapes
    let g = this.make.graphics({x:0, y:0, add:false});
    const colors = ['#FF00AA','#00C3FF','#40FF00','#FFD400','#9933FF'];
    const shapes = ['square','circle','diamond'];

    colors.forEach(color=>{
      // Square
      g.clear(); g.fillStyle(Phaser.Display.Color.HexStringToColor(color).color,1); g.fillRect(0,0,50,50); g.generateTexture('square-'+color,50,50);
      // Circle
      g.clear(); g.fillStyle(Phaser.Display.Color.HexStringToColor(color).color,1); g.fillCircle(25,25,25); g.generateTexture('circle-'+color,50,50);
      // Diamond
      g.clear(); g.fillStyle(Phaser.Display.Color.HexStringToColor(color).color,1); g.beginPath(); g.moveTo(25,0); g.lineTo(50,25); g.lineTo(25,50); g.lineTo(0,25); g.closePath(); g.fillPath(); g.generateTexture('diamond-'+color,50,50);
    });

    // Create blocks
    const gameWidth = this.cameras.main.width;
    const gameHeight = this.cameras.main.height;
    const cellWidth = 60;
    const cellHeight = 60;
    const cols = Math.ceil(gameWidth/cellWidth)+1;
    const rows = Math.ceil(gameHeight/cellHeight)+1;
    const totalBlocks = cols*rows;

    this.blocks = this.add.group();
    for(let i=0;i<totalBlocks;i++){
      let shape = shapes[i % shapes.length];
      let textureKey = shape+'-'+this.currentColor;
      let sprite = this.add.image(0,0,textureKey).setScale(0.5);
      sprite.setInteractive();
      this.blocks.add(sprite);
    }
    Phaser.Actions.GridAlign(this.blocks.getChildren(), {width:cols,height:rows,cellWidth:cellWidth,cellHeight:cellHeight,x:0,y:0});
    this.originalPositions = this.blocks.getChildren().map(b=>({x:b.x,y:b.y}));
    this.particles = this.add.particles('spark');

    // Mouse flee
    this.input.on('pointermove', pointer=>{
      this.blocks.getChildren().forEach(block=>{
        let angle = Phaser.Math.Angle.Between(block.x,block.y,pointer.x,pointer.y);
        let distance = Phaser.Math.Distance.Between(block.x,block.y,pointer.x,pointer.y);
        if(distance<1000){
          let fleeForce=(1000-distance)/100000*6000;
          block.x += Math.cos(angle+Math.PI)*fleeForce;
          block.y += Math.sin(angle+Math.PI)*fleeForce;
        }
      });
    });

    // Pulse animation
    const children = this.blocks.getChildren();
    children.forEach((child,idx)=>{ this.tweens.add({targets:child, scale:0.35, ease:'sine.inout', duration:600, delay:(idx%cols)*40, yoyo:true, repeat:-1 }); });

    // Text engine
    this.createTextEngine();

    // Color picker
    const colorOptions = document.querySelectorAll('.color-option');
    colorOptions.forEach(el=>{
      el.addEventListener('click', ()=>{
        colorOptions.forEach(c=>c.classList.remove('active'));
        el.classList.add('active');
        this.currentColor = el.dataset.color;
        this.updateBlocksTexture();
      });
    });
    colorOptions[0].classList.add('active');
  }

  updateBlocksTexture(){
    const shapes = ['square','circle','diamond'];
    this.blocks.getChildren().forEach((block,i)=>{
      let shape = shapes[i % 3];
      block.setTexture(shape+'-'+this.currentColor);
    });
  }

  update(time,delta){
    this.timeSincePhase += delta;
    if(this.timeSincePhase>this.phaseDuration){
      this.phase=(this.phase+1)%3;
      this.timeSincePhase=0;
      this.animateBlocksShape();
    }
    this.animateBlocks(time);
  }

  animateBlocksShape(){
    const shapes=['square','circle','diamond'];
    const shapeTextures = shapes.map(s=>`${s}-${this.currentColor}`);
    const newShape = shapeTextures[this.phase];
    this.blocks.getChildren().forEach(block=>block.setTexture(newShape));
  }

  animateBlocks(time){
    this.blocks.getChildren().forEach((block,i)=>{
      const orig = this.originalPositions[i];
      let offsetX=0, offsetY=0;
      switch(this.phase){
        case 0: offsetX=Math.sin(time/300+orig.y*0.12)*12; offsetY=Math.cos(time/400+orig.x*0.08)*8; break;
        case 1: let dx=orig.x-400, dy=orig.y-300, dist=Math.sqrt(dx*dx+dy*dy); offsetX=Math.sin(time/250+dist*0.05)*18; offsetY=Math.cos(time/350+dist*0.03)*12; break;
        case 2: offsetX=Math.sin(time/220+(orig.x+orig.y)*0.06)*15; offsetY=Math.cos(time/280+(orig.x-orig.y)*0.05)*10; break;
      }
      block.x = orig.x + offsetX;
      block.y = orig.y + offsetY;
    });
  }

  createTextEngine(){
    const input = document.getElementById("text-input");
    const button = document.getElementById("generate-btn");
    const clearBtn = document.getElementById("clear-history-btn");
    const historyList = document.getElementById("history-list");

    button.addEventListener("click",()=>{
      let text = input.value.toUpperCase().trim();
      if(!text) return;
      if(!this.history.includes(text)) this.history.push(text);
      this.updateHistoryUI();
      this.generateAnimatedText(text);
      this.currentAnimationText = text;
      if(this.popSound) this.popSound.play();
      input.value='';
    });

    input.addEventListener('keypress', e=>{
      if(e.key==='Enter') button.click();
    });

    clearBtn.addEventListener("click",()=>{
      this.history=[];
      this.updateHistoryUI();
      if(this.currentText) this.currentText.destroy();
    });
  }

  updateHistoryUI(){
    const historyList = document.getElementById("history-list");
    historyList.innerHTML = '';
    this.history.forEach(text=>{
      const item = document.createElement('div');
      item.className='history-item';
      if(text===this.currentAnimationText) item.classList.add('active');
      item.textContent=text;
      item.addEventListener('click',()=>{
        this.generateAnimatedText(text);
        this.currentAnimationText=text;
        if(this.popSound) this.popSound.play();
        this.updateHistoryUI();
      });
      historyList.appendChild(item);
    });
  }

  generateAnimatedText(text){
    const centerX=this.cameras.main.width/2;
    const centerY=this.cameras.main.height/2;

    // Slide old text out
    if(this.currentText){
      this.tweens.add({
        targets:this.currentText,
        x:this.cameras.main.width+200,
        alpha:0,
        duration:400,
        ease:'Cubic.easeIn',
        onComplete: ()=>{ this.currentText.destroy(); }
      });
    }

    // Create new text
    const style = {
      fontFamily:'Arial',
      fontSize:'48px',
      color:'#FFFFFF',
      stroke:'#000000',
      strokeThickness:6,
      shadow:{offsetX:3,offsetY:3,color:'#000000',blur:8,stroke:true,fill:true}
    };
    const newText=this.add.text(-200,centerY,text,style).setOrigin(0.5).setDepth(9999);
    this.tweens.add({targets:newText,x:centerX,alpha:1,duration:400,ease:'Cubic.easeOut'});
    this.currentText=newText;

    // Particles
    const emitter=this.particles.createEmitter({
      x:centerX,y:centerY,
      speed:{min:-150,max:150},
      lifespan:500,
      scale:{start:0.5,end:0},
      quantity:20,
      tint:Phaser.Display.Color.HexStringToColor(this.currentColor).color
    });
    emitter.explode(20,centerX,centerY);
  }
}

const config={type:Phaser.AUTO,width:window.innerWidth*0.70,height:window.innerHeight,backgroundColor:'#b8ffb8',parent:'phaser-example',scene:Example,render:{antialias:true}};
new Phaser.Game(config);
</script>

</body>
</html>
