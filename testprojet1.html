<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Phaser Shapes + Text Generator with History</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.85.0/dist/phaser.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      display: flex;
      font-family: Arial, sans-serif;
      overflow: hidden;
      background: #b8ffb8;
    }

    /* Phaser zone */
    #phaser-example {
      width: 70vw;
      height: 100vh;
    }

    /* Right-side interface */
    #right-panel {
      width: 30vw;
      height: 100vh;
      background: rgba(255,255,255,0.95);
      padding: 20px;
      box-sizing: border-box;
      backdrop-filter: blur(5px);
      overflow: auto;
      display: flex;
      flex-direction: column;
    }

    #right-panel h2 {
      margin-top: 0;
      color: #ff3eb5;
      font-size: 22px;
      text-align: center;
      margin-bottom: 15px;
    }

    #text-input {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      margin-bottom: 12px;
      border: 2px solid #ff3eb5;
      border-radius: 8px;
      outline: none;
      transition: all 0.3s ease;
    }

    #text-input:focus {
      box-shadow: 0 0 10px rgba(255, 62, 181, 0.3);
      transform: translateY(-2px);
    }

    #generate-btn {
      width: 100%;
      padding: 10px;
      background: #ff3eb5;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      margin-bottom: 15px;
    }

    #generate-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(255, 62, 181, 0.3);
    }

     #generate-btn:active {      transform: translateY(0);    }

    /* Font Selection */
    #font-selection {
      margin-bottom: 15px;
      padding: 10px 0;
      border-bottom: 1px solid #eee;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      color: #ff3eb5;
    }
    #font-select {
      margin-left: 10px;
      padding: 5px;
      border: 1px solid #ff3eb5;
      border-radius: 4px;
      outline: none;
    }

    /* Color Selection */    #color-selection {      display: flex;      justify-content: space-around;      margin-bottom: 15px;      padding: 10px 0;      border-top: 1px solid #eee;      border-bottom: 1px solid #eee;    }    .color-option {      width: 30px;      height: 30px;      border-radius: 50%;      cursor: pointer;      border: 3px solid transparent;      transition: all 0.2s ease;    }    .color-option:hover {      transform: scale(1.1);    }    .color-option.selected {      border-color: #333;      box-shadow: 0 0 8px rgba(0, 0, 0, 0.3);    }}

    /* History Section */
    .history-section {
      flex: 1;
      display: flex;
      flex-direction: column;
      margin-top: 10px;
    }

    .history-title {
      font-size: 14px;
      font-weight: 700;
      color: #ff3eb5;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 10px;
    }

    #history-list {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
      overflow-y: auto;
      margin-bottom: 10px;
    }

    #history-list::-webkit-scrollbar {
      width: 6px;
    }

    #history-list::-webkit-scrollbar-track {
      background: rgba(255, 62, 181, 0.1);
      border-radius: 10px;
    }

    #history-list::-webkit-scrollbar-thumb {
      background: #ff3eb5;
      border-radius: 10px;
    }

    .history-item {
      padding: 10px;
      background: rgba(255, 62, 181, 0.08);
      border: 1px solid rgba(255, 62, 181, 0.2);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 12px;
      color: #333;
      word-break: break-word;
      font-weight: 500;
    }

    .history-item:hover {
      background: rgba(255, 62, 181, 0.15);
      border-color: #ff3eb5;
      transform: translateX(3px);
    }

    .history-item.active {
      background: #ff3eb5;
      color: white;
      border-color: #ff3eb5;
      font-weight: 600;
    }

    .clear-history-btn {
      width: 100%;
      padding: 8px;
      background: rgba(255, 62, 181, 0.1);
      color: #ff3eb5;
      border: 1px solid #ff3eb5;
      border-radius: 6px;
      font-size: 11px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .clear-history-btn:hover {
      background: #ff3eb5;
      color: white;
    }

    #phaser-text {
      display: none;
    }
  </style>
</head>
<body>

<div id="phaser-example"></div>

<div id="right-panel">
  <h2>Créer une animation avec ton texte</h2>
  <input id="text-input" type="text" placeholder="Écris un mot ou une phrase…" maxlength="20">
  <button id="generate-btn">Générer l'animation</button>

  <div id="font-selection">
    <label for="font-select">Police :</label>
    <select id="font-select">
      <option value="Arial">Arial (Défaut)</option>
      <option value="Verdana">Verdana</option>
      <option value="Georgia">Georgia</option>
      <option value="Courier New">Courier New</option>
    </select>
  </div>

  <div id="color-selection">    <div class="color-option" data-color="#FF3EB5" data-shape="square" data-phase="0" style="background-color: #FF3EB5;"></div>    <div class="color-option" data-color="#3E83FF" data-shape="circle" data-phase="1" style="background-color: #3E83FF;"></div>    <div class="color-option" data-color="#3EFF5E" data-shape="diamond" data-phase="2" style="background-color: #3EFF5E;"></div>    <div class="color-option" data-color="#FFC73E" data-shape="star" data-phase="3" style="background-color: #FFC73E;"></div>    <div class="color-option" data-color="#C73EFF" data-shape="triangle" data-phase="4" style="background-color: #C73EFF;"></div>  </div>

  <div class="history-section">
    <div class="history-title">Historique</div>
    <div id="history-list"></div>
    <button class="clear-history-btn" id="clear-history-btn">Effacer l'historique</button>
  </div>

  <div id="phaser-text"></div>
</div>

<script>
class Example extends Phaser.Scene {
  constructor() {
    super();
    this.phase = 0;
    this.selectedColor = '#FF3EB5'; // Default color
    this.selectedPhase = 0; // Default phase
    this.selectedFont = 'Arial'; // Default font
    this.phaseDuration = 6000;
    this.timeSincePhase = 0;
    this.history = [];
    this.currentAnimationText = '';
    this.popSound = null;
    this.colorData = [
      { color: 0xFF3EB5, shape: 'square', phase: 0 },
      { color: 0x3E83FF, shape: 'circle', phase: 1 },
      { color: 0x3EFF5E, shape: 'diamond', phase: 2 },
      { color: 0xFFC73E, shape: 'star', phase: 3 },
      { color: 0xC73EFF, shape: 'triangle', phase: 4 },
    ];
  }

  preload() {
    this.load.setBaseURL('https://labs.phaser.io');
    this.load.image('spark', 'assets/particles/blue.png');
    this.load.audio('pop', 'assets/audio/SoundEffects/pop.wav');
  }

  create() {
    // Graphics for shapes
    var g = this.make.graphics({ x:0, y:0, add:false });

    // Square
    g.fillStyle(0xff3eb5,1);
    g.fillRect(0,0,50,50);
    g.generateTexture('square',50,50);

    // Circle
    g.clear();
    g.fillStyle(0xff3eb5,1);
    g.fillCircle(25,25,25);
    g.generateTexture('circle',50,50);

    // Diamond
    g.clear();
    g.fillStyle(0xff3eb5,1);
    g.beginPath();
    g.moveTo(25,0);
    g.lineTo(50,25);
    g.lineTo(25,50);
    g.lineTo(0,25);
    g.closePath();
    g.fillPath();
    g.generateTexture('diamond',50,50);

    // Star (5 points)
    g.clear();
    g.fillStyle(0xffc73e,1);
    var path = new Phaser.Curves.Path(25, 0);
    path.lineTo(35, 15);
    path.lineTo(50, 18);
    path.lineTo(40, 30);
    path.lineTo(45, 50);
    path.lineTo(25, 40);
    path.lineTo(5, 50);
    path.lineTo(10, 30);
    path.lineTo(0, 18);
    path.lineTo(15, 15);
    path.closePath();
    g.fillPoints(path.getPoints(), true);
    g.generateTexture('star',50,50);

    // Triangle
    g.clear();
    g.fillStyle(0xc73eff,1);
    g.beginPath();
    g.moveTo(25,0);
    g.lineTo(50,50);
    g.lineTo(0,50);
    g.closePath();
    g.fillPath();
    g.generateTexture('triangle',50,50);

    // Create blocks - FULL PAGE LAYOUT
    // Calculate grid dimensions to fill entire width
    var gameWidth = this.cameras.main.width;
    var gameHeight = this.cameras.main.height;
    var cellWidth = 60;
    var cellHeight = 60;
    var cols = Math.ceil(gameWidth / cellWidth) + 1;
    var rows = Math.ceil(gameHeight / cellHeight) + 1;
    var totalBlocks = cols * rows;

    var shapes = ['square','circle','diamond','star','triangle'];
    var blocks = this.add.group();
    for(var i=0;i<totalBlocks;i++){
      var key = shapes[i%shapes.length];
      var sprite = this.add.image(0,0,key).setScale(0.3);
      sprite.setInteractive();
      blocks.add(sprite);
    }

    Phaser.Actions.GridAlign(blocks.getChildren(), { width:cols, height:rows, cellWidth:cellWidth, cellHeight:cellHeight, x:0, y:0 });

    this.blocks = blocks;
    this.originalPositions = blocks.getChildren().map(function(b){return {x:b.x, y:b.y};});
    this.particles = this.add.particles('spark');
    this.shapes = shapes;
    // Set initial shape based on default phase
    this.blocks.getChildren().forEach(function(block){ block.setTexture(shapes[self.selectedPhase]); });

    var self=this;
    blocks.getChildren().forEach(function(block){
      block.on('pointerover', function(){ self.tweens.add({targets:block, scale:0.5, duration:150, yoyo:true}); });
      block.on('pointerdown', function(){ 
        if(self.sound){ try{self.sound.play('pop');}catch{} }
        var colorInt = parseInt(self.selectedColor.replace('#','0x'));
        self.particles.createEmitter({x:block.x, y:block.y, speed:{min:-150,max:150}, lifespan:500, scale:{start:0.5,end:0}, quantity:20, tint:colorInt}).explode(20, block.x, block.y);
      });
    });

    // Pulse animation
    var children = blocks.getChildren();
    children.forEach(function(child,idx){ self.tweens.add({targets:child, scale:0.35, ease:'sine.inout', duration:600, delay:(idx%cols)*40, yoyo:true, repeat:-1 }); });

    // Text engine
    this.createTextEngine();
    
    // Setup mouse flee effect
    this.setupMouseFleeEffect();
    
    // Setup audio
    this.setupAudio();
  }

  update(time, delta) {
    // Ensure the current phase is always the selected phase for animation
    this.phase = this.selectedPhase;

    if(this.input.activePointer.isDown){
      var mx=this.input.x, my=this.input.y;
      this.blocks.getChildren().forEach(function(block){
        var angle=Phaser.Math.Angle.Between(block.x, block.y, mx, my);
        block.x += Math.cos(angle)*0.6;
        block.y += Math.sin(angle)*0.6;
      });
    }

    this.animateBlocks(time);
  }

  animateBlocks(time){
    var self=this;
    this.blocks.getChildren().forEach(function(block,i){
      var orig=self.originalPositions[i];
      var offsetX=0, offsetY=0;
      
      // HORIZONTAL animation patterns
      switch(self.selectedPhase){
        case 0: // Square - Original Pink/Purple Wave
          offsetX=Math.sin(time/300 + orig.y*0.12)*12; 
          offsetY=Math.cos(time/400 + orig.x*0.08)*8;
          break;
        case 1: // Circle - Original Blue/Center Pulse
          var dx=orig.x-self.cameras.main.width/2, dy=orig.y-self.cameras.main.height/2, dist=Math.sqrt(dx*dx+dy*dy);
          offsetX=Math.sin(time/250 + dist*0.05)*18; 
          offsetY=Math.cos(time/350 + dist*0.03)*12;
          break;
        case 2: // Diamond - Original Green/Diagonal Wave
          offsetX=Math.sin(time/220 + (orig.x+orig.y)*0.06)*15; 
          offsetY=Math.cos(time/280 + (orig.x-orig.y)*0.05)*10;
          break;
        case 3: // Star - Yellow/Spiral Out
          var angle = Phaser.Math.Angle.Between(orig.x, orig.y, self.cameras.main.width/2, self.cameras.main.height/2);
          var dist = Phaser.Math.Distance.Between(orig.x, orig.y, self.cameras.main.width/2, self.cameras.main.height/2);
          offsetX = Math.sin(time/150 + dist*0.01) * 10;
          offsetY = Math.cos(time/150 + dist*0.01) * 10;
          break;
        case 4: // Triangle - Purple/Vertical Shear
          offsetX = Math.sin(time/400 + orig.y*0.05) * 5;
          offsetY = Math.cos(time/200 + orig.x*0.08) * 15;
          break;
      }
      
      block.x = orig.x + offsetX;
      block.y = orig.y + offsetY;
    });
  }

  createTextEngine(){
    var input=document.getElementById("text-input");
    var button=document.getElementById("generate-btn");
    var historyList=document.getElementById("history-list");
    var clearBtn=document.getElementById("clear-history-btn");
    var colorOptions=document.querySelectorAll(".color-option");
    var fontSelect=document.getElementById("font-select");
    var self=this;

    // Font selection logic
    fontSelect.addEventListener("change", function(){
      self.selectedFont = fontSelect.value;
    });

    // Color selection logic
    colorOptions.forEach(function(option){
      option.addEventListener("click", function(){
        // Remove 'selected' from all
        colorOptions.forEach(function(opt){ opt.classList.remove('selected'); });
        // Add 'selected' to current
        option.classList.add('selected');
        // Update scene properties
        self.selectedColor = option.getAttribute('data-color');
        self.selectedPhase = parseInt(option.getAttribute('data-phase'));
        var newShape = option.getAttribute('data-shape');
        // Change background shapes
        self.blocks.getChildren().forEach(function(block){ block.setTexture(newShape); });
        // Update particle tint
        var colorInt = parseInt(self.selectedColor.replace('#','0x'));
        self.particles.emitters.list.forEach(function(emitter){ emitter.tint = colorInt; });
      });
    });
    // Set default selected color
    document.querySelector('.color-option[data-phase="0"]').classList.add('selected');

    button.addEventListener("click", function(){
      var text=input.value.toUpperCase().trim();
      if(!text) return;

      // Add to history
      if(!self.history.includes(text)){
        self.history.push(text);
      }

      // Update UI
      self.updateHistoryUI();
      
      // Generate animation
      self.generateAnimatedText(text);
      self.currentAnimationText = text;
      
      // Play sound once on click
      self.playSoundOnce();
      
      input.value = '';
    });

    input.addEventListener('keypress', function(e){
      if(e.key === 'Enter'){
        button.click();
      }
    });

    clearBtn.addEventListener("click", function(){
      self.history = [];
      self.updateHistoryUI();
      self.clearAnimatedText();
    });
  }

  updateHistoryUI(){
    var historyList=document.getElementById("history-list");
    historyList.innerHTML = '';
    var self = this;

    this.history.forEach(function(text){
      var item = document.createElement('div');
      item.className = 'history-item';
      if(text === self.currentAnimationText){
        item.classList.add('active');
      }
      item.textContent = text;
      
      item.addEventListener('click', function(){
        self.generateAnimatedText(text);
        self.currentAnimationText = text;
        self.updateHistoryUI();
        self.playSoundOnce();
      });

      historyList.appendChild(item);
    });
  }

  generateAnimatedText(text){
    if(!text) return;
    var self = this;

    // Exit animation for previous text (creative and high speed)
    if(this.letters){
      this.letters.forEach(function(l, idx){
        self.tweens.add({
          targets: l,
          y: self.cameras.main.height * 1.5, // Exit downwards
          alpha: 0,
          angle: 360,
          scale: 0,
          duration: 300 + idx * 20, // Fast exit
          ease: 'Back.easeIn',
          onComplete: function(){ l.destroy(); }
        });
      });
    }
    this.letters=[];

    // Position au centre de l'écran
    var centerY = this.cameras.main.height / 2;
    
    var charWidth = 40; // Increased width for better spacing
    var totalWidth = text.length * charWidth;
    var centerX = this.cameras.main.width / 2;
    var startX = centerX - totalWidth / 2 + charWidth/2; // Center alignment adjustment
    
    var colorHex = self.selectedColor;
    var letterDelay = 50; // Delay between letters
    var entranceDuration = 400; // Fast entrance duration
    var font = self.selectedFont;

    for(var i=0;i<text.length;i++){
      (function(self,ch,idx){
        var xPos = startX + idx * charWidth;
        var delay = idx * letterDelay;
        
        // Create text
        var letter=self.add.text(xPos, centerY, ch, {fontFamily:font, fontSize:'60px', color:colorHex, fontWeight: 'bold'}).setOrigin(0.5).setDepth(100);
        self.letters.push(letter);
        
        // Initial state (creative entry)
        letter.setAlpha(0);
        letter.setScale(0.1);
        letter.setAngle(Phaser.Math.Between(-180, 180));
        letter.setY(centerY - 200); // Start high

        // Entrance animation (creative and high speed)
        self.tweens.add({
          targets: letter,
          y: centerY,
          alpha: 1,
          scale: 1,
          angle: 0,
          duration: entranceDuration,
          delay: delay,
          ease: 'Back.easeOut.config(2.5)' // Creative bounce-in
        });
        
        // Continuous floating animation (subtle)
        self.tweens.add({
          targets: letter,
          y: centerY + 10,
          duration: 2000 + idx * 100,
          ease: "sine.inout",
          delay: entranceDuration + delay,
          yoyo: true,
          repeat: -1
        });
      })(this,text[i],i);
    }
  }}

  clearAnimatedText(){
    if(this.letters){
      this.letters.forEach(function(l){l.destroy();});
      this.letters = [];
    }
  }

  setupAudio(){
    var self = this;
    try {
      this.popSound = this.sound.add('pop', { loop: false, volume: 0.5 });
    } catch(e){
      console.log('Audio setup skipped');
    }
  }

  playSoundOnce(){
    if(this.popSound){
      try {
        this.popSound.stop();
        this.popSound.play();
      } catch(e){
        console.log('Sound play error');
      }
    }
  }

  setupMouseFleeEffect(){
    var self = this;
    this.input.on('pointermove', function(pointer){
      if(!self.blocks) return;

      self.blocks.getChildren().forEach(function(block){
        var angle = Phaser.Math.Angle.Between(block.x, block.y, pointer.x, pointer.y);
        var distance = Phaser.Math.Distance.Between(block.x, block.y, pointer.x, pointer.y);
        
        // Flee effect - stronger when closer (distance < 150)
        if(distance < 1000){
          var fleeForce = (1000 - distance) / 100000 * 6000;
          block.x += Math.cos(angle + Math.PI) * fleeForce;
          block.y += Math.sin(angle + Math.PI) * fleeForce;
        }
      });
    });
  }
}

var config = { type: Phaser.AUTO, width: window.innerWidth*0.70, height: window.innerHeight, backgroundColor:'#b8ffb8', parent:'phaser-example', scene:Example, render: { antialias: true } };
new Phaser.Game(config);
</script>

</body>
</html>
