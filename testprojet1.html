<!DOCTYPE html>
<html lang="fr">
<head>
Â  <meta charset="UTF-8">
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  <title>Phaser Shapes + Text Generator with History</title>
Â  <script src="https://cdn.jsdelivr.net/npm/phaser@3.85.0/dist/phaser.js"></script>
Â  <style>
Â  Â  body {
Â  Â  Â  margin: 0;
Â  Â  Â  padding: 0;
Â  Â  Â  display: flex;
Â  Â  Â  font-family: Arial, sans-serif;
Â  Â  Â  overflow: hidden;
Â  Â  Â  background: #b8ffb8;
Â  Â  }

Â  Â  /* Phaser zone */
Â  Â  #phaser-example {
Â  Â  Â  width: 70vw;
Â  Â  Â  height: 100vh;
Â  Â  }

Â  Â  /* Right-side interface */
Â  Â  #right-panel {
Â  Â  Â  width: 30vw;
Â  Â  Â  height: 100vh;
Â  Â  Â  background: rgba(255,255,255,0.95);
Â  Â  Â  padding: 20px;
Â  Â  Â  box-sizing: border-box;
Â  Â  Â  backdrop-filter: blur(5px);
Â  Â  Â  overflow: auto;
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  }

Â  Â  #right-panel h2 {
Â  Â  Â  margin-top: 0;
Â  Â  Â  color: #ff3eb5;
Â  Â  Â  font-size: 22px;
Â  Â  Â  text-align: center;
Â  Â  Â  margin-bottom: 15px;
Â  Â  }

Â  Â  #text-input {
Â  Â  Â  width: 100%;
Â  Â  Â  padding: 10px;
Â  Â  Â  font-size: 16px;
Â  Â  Â  margin-bottom: 12px;
Â  Â  Â  border: 2px solid #ff3eb5;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  outline: none;
Â  Â  Â  transition: all 0.3s ease;
Â  Â  }

Â  Â  #text-input:focus {
Â  Â  Â  box-shadow: 0 0 10px rgba(255, 62, 181, 0.3);
Â  Â  Â  transform: translateY(-2px);
Â  Â  }

Â  Â  .control-btn {
Â  Â  Â  width: 100%;
Â  Â  Â  padding: 10px;
Â  Â  Â  color: white;
Â  Â  Â  border: none;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  font-size: 16px;
Â  Â  Â  cursor: pointer;
Â  Â  Â  transition: all 0.3s ease;
Â  Â  Â  font-weight: 600;
Â  Â  Â  margin-bottom: 10px;
Â  Â  }

Â  Â  #generate-btn {
Â  Â  Â  background: #ff3eb5;
Â  Â  }

Â  Â  #random-btn {
Â  Â  Â  background: #333;
Â  Â  }

Â  Â  #export-btn {
Â  Â  Â  background: #009688;
Â  Â  Â  margin-bottom: 15px;
Â  Â  }

Â  Â  .control-btn:hover {
Â  Â  Â  transform: translateY(-2px);
Â  Â  Â  box-shadow: 0 5px 15px rgba(0,0,0,0.2);
Â  Â  }

Â  Â  .control-btn:active {
Â  Â  Â  transform: translateY(0);
Â  Â  }

Â  Â  /* Color Picker Section */
Â  Â  .color-picker, .animation-controls, .info-section {
Â  Â  Â  margin-bottom: 15px;
Â  Â  Â  padding: 10px;
Â  Â  Â  border: 1px solid #ddd;
Â  Â  Â  border-radius: 8px;
Â  Â  }

Â  Â  .picker-title {
Â  Â  Â  font-size: 14px;
Â  Â  Â  font-weight: 700;
Â  Â  Â  color: #333;
Â  Â  Â  text-transform: uppercase;
Â  Â  Â  letter-spacing: 0.5px;
Â  Â  Â  margin-bottom: 10px;
Â  Â  }

Â  Â  #color-options {
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: space-around;
Â  Â  }

Â  Â  .color-swatch {
Â  Â  Â  width: 30px;
Â  Â  Â  height: 30px;
Â  Â  Â  border-radius: 50%;
Â  Â  Â  border: 3px solid transparent;
Â  Â  Â  cursor: pointer;
Â  Â  Â  transition: all 0.2s ease;
Â  Â  Â  box-shadow: 0 2px 5px rgba(0,0,0,0.2);
Â  Â  }

Â  Â  .color-swatch.active {
Â  Â  Â  border-color: #333;
Â  Â  Â  transform: scale(1.1);
Â  Â  }

Â  Â  /* Controls (Sliders) */
Â  Â  .control-group {
Â  Â  Â  margin-bottom: 10px;
Â  Â  }

Â  Â  .control-group label {
Â  Â  Â  display: block;
Â  Â  Â  font-size: 12px;
Â  Â  Â  font-weight: 600;
Â  Â  Â  margin-bottom: 5px;
Â  Â  }

Â  Â  .control-group input[type="range"] {
Â  Â  Â  width: 100%;
Â  Â  Â  -webkit-appearance: none;
Â  Â  Â  height: 8px;
Â  Â  Â  background: #ddd;
Â  Â  Â  border-radius: 5px;
Â  Â  Â  outline: none;
Â  Â  }

Â  Â  .control-group input[type="range"]::-webkit-slider-thumb {
Â  Â  Â  -webkit-appearance: none;
Â  Â  Â  appearance: none;
Â  Â  Â  width: 16px;
Â  Â  Â  height: 16px;
Â  Â  Â  border-radius: 50%;
Â  Â  Â  background: #ff3eb5; /* Mis Ã  jour par JS */
Â  Â  Â  cursor: pointer;
Â  Â  Â  box-shadow: 0 0 5px rgba(0,0,0,0.3);
Â  Â  }
Â  Â  
Â  Â  /* Utilisation d'un attribut data pour permettre la customisation par JS */
Â  Â  #right-panel[data-color] .control-group input[type="range"]::-webkit-slider-thumb {
Â  Â  Â  background: var(--main-color, #ff3eb5);
Â  Â  }


Â  Â  /* Info Section */
Â  Â  .info-section p {
Â  Â  Â  margin: 5px 0;
Â  Â  Â  font-size: 12px;
Â  Â  }

Â  Â  .info-section strong {
Â  Â  Â  color: #ff3eb5; /* Mis Ã  jour par JS */
Â  Â  }

Â  Â  /* History Section (styles kept from previous step) */
Â  Â  .history-section {
Â  Â  Â  flex: 1;
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  Â  margin-top: 10px;
Â  Â  }

Â  Â  .history-title {
Â  Â  Â  font-size: 14px;
Â  Â  Â  font-weight: 700;
Â  Â  Â  color: #ff3eb5;
Â  Â  Â  text-transform: uppercase;
Â  Â  Â  letter-spacing: 1px;
Â  Â  Â  margin-bottom: 10px;
Â  Â  }

Â  Â  #history-list {
Â  Â  Â  flex: 1;
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  Â  gap: 8px;
Â  Â  Â  overflow-y: auto;
Â  Â  Â  margin-bottom: 10px;
Â  Â  }

Â  Â  .history-item {
Â  Â  Â  padding: 10px;
Â  Â  Â  background: rgba(255, 62, 181, 0.08);
Â  Â  Â  border: 1px solid rgba(255, 62, 181, 0.2);
Â  Â  Â  border-radius: 6px;
Â  Â  Â  cursor: pointer;
Â  Â  Â  transition: all 0.3s ease;
Â  Â  Â  font-size: 12px;
Â  Â  Â  color: #333;
Â  Â  Â  word-break: break-word;
Â  Â  Â  font-weight: 500;
Â  Â  }

Â  Â  .history-item:hover {
Â  Â  Â  background: rgba(255, 62, 181, 0.15);
Â  Â  Â  border-color: #ff3eb5;
Â  Â  Â  transform: translateX(3px);
Â  Â  }

Â  Â  .history-item.active {
Â  Â  Â  background: #ff3eb5;
Â  Â  Â  color: white;
Â  Â  Â  border-color: #ff3eb5;
Â  Â  Â  font-weight: 600;
Â  Â  }

Â  Â  .clear-history-btn {
Â  Â  Â  width: 100%;
Â  Â  Â  padding: 8px;
Â  Â  Â  background: rgba(255, 62, 181, 0.1);
Â  Â  Â  color: #ff3eb5;
Â  Â  Â  border: 1px solid #ff3eb5;
Â  Â  Â  border-radius: 6px;
Â  Â  Â  font-size: 11px;
Â  Â  Â  cursor: pointer;
Â  Â  Â  transition: all 0.3s ease;
Â  Â  Â  font-weight: 600;
Â  Â  Â  text-transform: uppercase;
Â  Â  Â  letter-spacing: 0.5px;
Â  Â  }

Â  Â  .clear-history-btn:hover {
Â  Â  Â  background: #ff3eb5;
Â  Â  Â  color: white;
Â  Â  }

Â  Â  #phaser-text {
Â  Â  Â  display: none;
Â  Â  }
Â  </style>
</head>
<body>

<div id="phaser-example"></div>

<div id="right-panel">
Â  <h2>CrÃ©ateur d'Animation Dynamique</h2>

Â  <div class="color-picker">
Â  Â  <div class="picker-title">ğŸ¨ ThÃ¨me de Couleur</div>
Â  Â  <div id="color-options"></div>
Â  </div>

Â  <div class="info-section">
Â  Â  <div class="picker-title">â„¹ï¸ Infos ThÃ¨me Actuel</div>
Â  Â  <p>Couleur: <strong id="info-hex">#FF3EB5</strong></p>
Â  Â  <p>Police: <strong id="info-font">Arial</strong></p>
Â  </div>

Â  <div class="animation-controls">
Â  Â  <div class="picker-title">âš™ï¸ ContrÃ´les Blocs</div>
Â  Â  <div class="control-group">
Â  Â  Â  <label for="speed-slider">Vitesse (plus bas = plus rapide)</label>
Â  Â  Â  <input type="range" id="speed-slider" min="50" max="600" value="300">
Â  Â  </div>
Â  Â  <div class="control-group">
Â  Â  Â  <label for="amplitude-slider">Amplitude (taille du mouvement)</label>
Â  Â  Â  <input type="range" id="amplitude-slider" min="1" max="50" value="15">
Â  Â  </div>
Â  </div>
Â Â 
Â  <input id="text-input" type="text" placeholder="Ã‰cris un mot ou une phraseâ€¦" maxlength="20">
Â  <button id="generate-btn" class="control-btn">GÃ©nÃ©rer l'animation</button>
Â  <button id="random-btn" class="control-btn">Surprise Me! ğŸ²</button>
Â  <button id="export-btn" class="control-btn">Exporter en PNG ğŸ–¼ï¸</button>


Â  <div class="history-section">
Â  Â  <div class="history-title">Historique</div>
Â  Â  <div id="history-list"></div>
Â  Â  <button class="clear-history-btn" id="clear-history-btn">Effacer l'historique</button>
Â  </div>

Â  <div id="phaser-text"></div>
</div>

<script>
class Example extends Phaser.Scene {
Â  constructor() {
Â  Â  super();
Â  Â  this.colorConfigs = {
Â  Â  Â  'pink': { hex: 0xff3eb5, style: { color: '#ff3eb5', fontFamily: 'Arial', fontWeight: 'bold' }, shapeIndex: 0 },
Â  Â  Â  'blue': { hex: 0x3e8aff, style: { color: '#3e8aff', fontFamily: 'Verdana', fontWeight: 'bold' }, shapeIndex: 1 },
Â  Â  Â  'yellow': { hex: 0xffe83e, style: { color: '#888800', fontFamily: 'Impact', fontWeight: 'bold' }, shapeIndex: 2 },
Â  Â  Â  'green': { hex: 0x3eff8a, style: { color: '#008800', fontFamily: 'Courier New', fontWeight: 'bold' }, shapeIndex: 3 },
Â  Â  Â  'red': { hex: 0xff3e3e, style: { color: '#ff3e3e', fontFamily: 'Times New Roman', fontWeight: 'bold' }, shapeIndex: 4 }
Â  Â  };
Â  Â  this.funnyTexts = [
Â  Â  Â  "CODE MAGIQUE", "HELLO WORLD", "PHASER ROCKS", "L'OEUF OU LA POULE", "GÃ‰NIAL!", "PIXELS PARTOUT"
Â  Â  ];
Â  Â  this.currentTheme = 'pink';
Â  Â  this.history = [];
Â  Â  this.currentAnimationText = '';
Â  Â  this.popSound = null;
Â  Â  this.shapes = ['square','circle','diamond','triangle','star']; 
Â  Â  this.letters = []; 
Â  Â  this.oldLetters = []; 
Â  Â  this.blockTweens = []; // Stockage des tweens de pulsation des blocs
Â  Â  this.speed = 300; // Vitesse d'animation (initiale)
Â  Â  this.amplitude = 15; // Amplitude d'animation (initiale)
Â  }

Â  preload() {
Â  Â  this.load.setBaseURL('https://labs.phaser.io');
Â  Â  this.load.image('spark', 'assets/particles/blue.png');
Â  Â  this.load.audio('pop', 'assets/audio/SoundEffects/pop.wav');
Â  }

Â  create() {
Â  Â  this.createShapeTextures();
Â  Â  this.createBlocks();
Â  Â  this.setupBlockInteractions();
Â  Â  this.createTextEngine();
Â  Â  this.setupMouseFleeEffect();
Â  Â  this.setupAudio();
Â  Â  this.setupColorPicker(); 
Â  Â  this.setupAnimationControls(); 
Â  Â  this.applyTheme(this.currentTheme, { updateControls: true }); 
Â  }
Â  
Â  createShapeTextures(){
Â  Â  var g = this.make.graphics({ x:0, y:0, add:false });
Â  Â  var size = 50;
Â  Â  var shapesData = [
Â  Â  Â  { key: 'square', func: () => g.fillRect(0,0,size,size) },
Â  Â  Â  { key: 'circle', func: () => g.fillCircle(size/2,size/2,size/2) },
Â  Â  Â  { key: 'diamond', func: () => { g.beginPath(); g.moveTo(size/2,0); g.lineTo(size,size/2); g.lineTo(size/2,size); g.lineTo(0,size/2); g.closePath(); g.fillPath(); } },
Â  Â  Â  { key: 'triangle', func: () => { g.beginPath(); g.moveTo(size/2, 0); g.lineTo(size, size); g.lineTo(0, size); g.closePath(); g.fillPath(); } },
Â  Â  Â  { key: 'star', func: () => g.fillRect(15,15,20,20) }
Â  Â  ];

Â  Â  shapesData.forEach(function(s){
Â  Â  Â  g.clear();
Â  Â  Â  g.fillStyle(0xffffff,1);
Â  Â  Â  s.func();
Â  Â  Â  g.generateTexture(s.key,size,size);
Â  Â  });
Â  }
Â  
Â  createBlocks(){
Â  Â  var gameWidth = this.cameras.main.width;
Â  Â  var gameHeight = this.cameras.main.height;
Â  Â  var cellWidth = 60;
Â  Â  var cellHeight = 60;
Â  Â  var cols = Math.ceil(gameWidth / cellWidth) + 1;
Â  Â  var rows = Math.ceil(gameHeight / cellHeight) + 1;
Â  Â  var totalBlocks = cols * rows;

Â  Â  var blocks = this.add.group();
Â  Â  for(var i=0;i<totalBlocks;i++){
Â  Â  Â  var key = this.shapes[i%this.shapes.length];
Â  Â  Â  var sprite = this.add.image(0,0,key).setScale(0.3);
Â  Â  Â  sprite.setInteractive();
Â  Â  Â  blocks.add(sprite);
Â  Â  }

Â  Â  Phaser.Actions.GridAlign(blocks.getChildren(), { width:cols, height:rows, cellWidth:cellWidth, cellHeight:cellHeight, x:0, y:0 });

Â  Â  this.blocks = blocks;
Â  Â  this.originalPositions = blocks.getChildren().map(function(b){return {x:b.x, y:b.y};});
Â  Â  this.particles = this.add.particles('spark');
Â  Â  this.cols = cols;
Â  Â  
Â  Â  // Applique la pulsation initiale
Â  Â  this.applyBlockPulse(this.currentTheme);
Â  }

Â  // Nouvelle mÃ©thode pour gÃ©rer la pulsation
Â  applyBlockPulse(themeName){
Â  Â  // DÃ©truire les tweens de pulsation existants
Â  Â  this.blockTweens.forEach(tween => tween.stop());
Â  Â  this.blockTweens = [];

Â  Â  var self = this;
Â  Â  var children = this.blocks.getChildren();
Â  Â  var cols = this.cols; 

Â  Â  children.forEach(function(child,idx){ 
Â  Â  Â  // Ajout d'une pulsation selon le thÃ¨me
Â  Â  Â  var duration = (themeName === 'red') ? 300 : 600; 
Â  Â  Â  var scaleTo = (themeName === 'blue') ? 0.45 : 0.35;

Â  Â  Â  var tween = self.tweens.add({
Â  Â  Â  Â  targets: child, 
Â  Â  Â  Â  scale: scaleTo, 
Â  Â  Â  Â  ease:'sine.inout', 
Â  Â  Â  Â  duration: duration, 
Â  Â  Â  Â  delay: (idx%cols)*40, 
Â  Â  Â  Â  yoyo: true, 
Â  Â  Â  Â  repeat: -1 
Â  Â  Â  });
Â  Â  Â  this.blockTweens.push(tween);
Â  Â  }, this);
Â  }
Â  
Â  setupBlockInteractions(){
Â  Â  var self=this;
Â  Â  this.blocks.getChildren().forEach(function(block){
Â  Â  Â  // Laissez le pointerover gÃ©rer le scale:0.5 comme un effet amusant
Â  Â  Â  block.on('pointerover', function(){ self.tweens.add({targets:block, scale:0.5, duration:150, yoyo:true}); });
Â  Â  Â  block.on('pointerdown', function(){Â 
Â  Â  Â  Â  self.blockHit(block);
Â  Â  Â  });
Â  Â  });
Â  }
Â  
Â  blockHit(block){
Â  Â  if(this.popSound){ try{this.popSound.play();}catch{} }
Â  Â  var hexColor = this.colorConfigs[this.currentTheme].hex;
Â  Â  this.particles.createEmitter({x:block.x, y:block.y, speed:{min:-150,max:150}, lifespan:500, scale:{start:0.5,end:0}, quantity:20, tint:hexColor}).explode(20, block.x, block.y);
Â  }

Â  applyTheme(themeName, { updateControls = false, regenerateText = true }){
Â  Â  var config = this.colorConfigs[themeName];
Â  Â  var hex = config.hex;
Â  Â  this.currentTheme = themeName;

Â  Â  // 1. Mettre Ã  jour les couleurs des blocs, la texture de base et la pulsation
Â  Â  var shapeKey = this.shapes[config.shapeIndex % this.shapes.length];
Â  Â  this.blocks.getChildren().forEach(function(block){ 
Â  Â  Â  block.setTexture(shapeKey);
Â  Â  Â  block.setTint(hex);
Â  Â  });
Â  Â  this.applyBlockPulse(themeName);

Â  Â  // 2. Mettre Ã  jour l'animation de texte si elle est visible
Â  Â  if(this.currentAnimationText && regenerateText){
Â  Â  Â  // Si on change juste de thÃ¨me, on ne veut pas l'animation GAUCHE->DROITE
Â  Â  Â  this.generateAnimatedText(this.currentAnimationText, { instant: true }); 
Â  Â  }

Â  Â  // 3. Mettre Ã  jour l'interface (couleurs des boutons, etc.)
Â  Â  var hexString = `#${hex.toString(16).toUpperCase().padStart(6, '0')}`;
Â  Â  
Â  Â  document.getElementById('right-panel').style.setProperty('--main-color', hexString);

Â  Â  document.getElementById('generate-btn').style.background = config.style.color;
Â  Â  document.getElementById('text-input').style.borderColor = config.style.color;
Â  Â  document.querySelector('#right-panel h2').style.color = config.style.color;
Â  Â  document.querySelector('.history-title').style.color = config.style.color;
Â  Â  document.querySelector('.clear-history-btn').style.color = config.style.color;
Â  Â  document.querySelector('.clear-history-btn').style.borderColor = config.style.color;
Â  Â  
Â  Â  // Mettre Ã  jour la couleur des strong dans la section info
Â  Â  document.querySelectorAll('.info-section strong').forEach(strong => {
Â  Â  Â  strong.style.color = config.style.color;
Â  Â  });


Â  Â  // 4. Mettre Ã  jour les infos du panneau
Â  Â  document.getElementById('info-hex').textContent = hexString;
Â  Â  document.getElementById('info-font').textContent = config.style.fontFamily;

Â  Â  // 5. Mettre Ã  jour les indicateurs de sÃ©lection de couleur
Â  Â  document.querySelectorAll('.color-swatch').forEach(swatch => {
Â  Â  Â  if(swatch.dataset.color === themeName){
Â  Â  Â  Â  swatch.classList.add('active');
Â  Â  Â  } else {
Â  Â  Â  Â  swatch.classList.remove('active');
Â  Â  Â  }
Â  Â  });

Â  Â  // 6. Mettre Ã  jour les contrÃ´les UI si nÃ©cessaire (utile pour le mode alÃ©atoire/historique)
Â  Â  if (updateControls) {
Â  Â  Â  document.getElementById('speed-slider').value = this.speed;
Â  Â  Â  document.getElementById('amplitude-slider').value = this.amplitude;
Â  Â  }
Â  Â  
Â  Â  // 7. Mettre Ã  jour l'historique UI (pour la classe 'active')
Â  Â  this.updateHistoryUI();
Â  }

Â  setupColorPicker(){
Â  Â  var colorOptions = document.getElementById('color-options');
Â  Â  var self = this;

Â  Â  for(var themeName in this.colorConfigs){
Â  Â  Â  (function(themeName, config){
Â  Â  Â  Â  var swatch = document.createElement('div');
Â  Â  Â  Â  swatch.className = 'color-swatch';
Â  Â  Â  Â  swatch.style.backgroundColor = config.style.color;
Â  Â  Â  Â  swatch.dataset.color = themeName;
Â  Â  Â  Â  
Â  Â  Â  Â  swatch.addEventListener('click', function(){
Â  Â  Â  Â  Â  self.applyTheme(themeName, { regenerateText: true });
Â  Â  Â  Â  });

Â  Â  Â  Â  colorOptions.appendChild(swatch);
Â  Â  Â  })(themeName, this.colorConfigs[themeName]);
Â  Â  }
Â  }

Â  setupAnimationControls(){
Â  Â  var self = this;
Â  Â  var speedSlider = document.getElementById('speed-slider');
Â  Â  var amplitudeSlider = document.getElementById('amplitude-slider');

Â  Â  speedSlider.addEventListener('input', function(){
Â  Â  Â  self.speed = parseInt(this.value);
Â  Â  Â  // Mettre Ã  jour l'animation de texte si elle est visible avec la nouvelle vitesse
Â  Â  Â  if(self.currentAnimationText) {
Â  Â  Â  Â  self.generateAnimatedText(self.currentAnimationText, { instant: true }); 
Â  Â  Â  }
Â  Â  });

Â  Â  amplitudeSlider.addEventListener('input', function(){
Â  Â  Â  self.amplitude = parseInt(this.value);
Â  Â  });
Â  }


Â  update(time, delta) {
Â  Â  
Â  Â  if(this.input.activePointer.isDown){
Â  Â  Â  var mx=this.input.x, my=this.input.y;
Â  Â  Â  this.blocks.getChildren().forEach(function(block){
Â  Â  Â  Â  var angle=Phaser.Math.Angle.Between(block.x, block.y, mx, my);
Â  Â  Â  Â  block.x += Math.cos(angle)*0.6;
Â  Â  Â  Â  block.y += Math.sin(angle)*0.6;
Â  Â  Â  });
Â  Â  }

Â  Â  this.animateBlocks(time);
Â  }

Â  animateBlocks(time){
Â  Â  var self=this;
Â  Â  var config = self.colorConfigs[self.currentTheme];
Â  Â  var phase = config.shapeIndex;
Â  Â  var amplitude = self.amplitude;
Â  Â  var speed = self.speed;

Â  Â  this.blocks.getChildren().forEach(function(block,i){
Â  Â  Â  var orig=self.originalPositions[i];
Â  Â  Â  var offsetX=0, offsetY=0;
Â  Â  Â Â 
Â  Â  Â  // DiffÃ©rents schÃ©mas d'animation basÃ©s sur la phase/couleur
Â  Â  Â  switch(phase){
Â  Â  Â  Â  case 0: // Pink - Waves in both axis
Â  Â  Â  Â  Â  offsetX=Math.sin(time/speed + orig.y*0.12)*amplitude;Â 
Â  Â  Â  Â  Â  offsetY=Math.cos(time/(speed+100) + orig.x*0.08)*(amplitude*0.6);
Â  Â  Â  Â  Â  block.angle = Math.sin(time/(speed*1.5))*5;
Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  case 1: // Blue - Circular/spiral movement
Â  Â  Â  Â  Â  var dist=Phaser.Math.Distance.Between(orig.x, orig.y, 400, 300);
Â  Â  Â  Â  Â  offsetX=Math.sin(time/speed + dist*0.05)*amplitude;Â 
Â  Â  Â  Â  Â  offsetY=Math.cos(time/speed + dist*0.05)*amplitude;
Â  Â  Â  Â  Â  block.angle = time/50 % 360;
Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  case 2: // Yellow - Diagonal / Swirling
Â  Â  Â  Â  Â  offsetX=Math.sin(time/(speed*0.8) + (orig.x+orig.y)*0.06)*amplitude;Â 
Â  Â  Â  Â  Â  offsetY=Math.cos(time/(speed*0.9) + (orig.x-orig.y)*0.05)*(amplitude*0.7);
Â  Â  Â  Â  Â  block.angle = Math.sin(time/speed)*10;
Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  case 3: // Green - Vertical/Horizontal only (Grid)
Â  Â  Â  Â  Â  offsetX=Math.sin(time/speed + orig.y*0.1) * (amplitude*0.7);
Â  Â  Â  Â  Â  offsetY=Math.sin(time/speed + orig.x*0.1) * (amplitude*0.7);
Â  Â  Â  Â  Â  block.angle = 0;
Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  case 4: // Red - Random shake/pulse
Â  Â  Â  Â  Â  offsetX=Math.sin(time/100 + i)*(amplitude*0.3);
Â  Â  Â  Â  Â  offsetY=Math.cos(time/120 + i)*(amplitude*0.3);
Â  Â  Â  Â  Â  block.angle = Math.random() * 5 - 2.5;
Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  default:
Â  Â  Â  Â  Â  offsetX=Math.sin(time/speed + orig.y*0.12)*amplitude;Â 
Â  Â  Â  Â  Â  offsetY=Math.cos(time/(speed+100) + orig.x*0.08)*(amplitude*0.6);
Â  Â  Â  Â  Â  block.angle = 0;
Â  Â  Â  Â  Â  break;
Â  Â  Â  }
Â  Â  Â Â 
Â  Â  Â  block.x = orig.x + offsetX;
Â  Â  Â  block.y = orig.y + offsetY;
Â  Â  });
Â  }
Â  
Â  animateOldTextOut(){
Â  Â  if(this.oldLetters && this.oldLetters.length > 0){
Â  Â  Â  var gameWidth = this.cameras.main.width;
Â  Â  Â  var self = this;
Â  Â  Â  
Â  Â  Â  this.oldLetters.forEach(function(item, idx){
Â  Â  Â  Â  self.tweens.add({
Â  Â  Â  Â  Â  targets: item,
Â  Â  Â  Â  Â  x: gameWidth + 50, 
Â  Â  Â  Â  Â  alpha: 0,
Â  Â  Â  Â  Â  duration: 300, 
Â  Â  Â  Â  Â  ease: 'Quad.easeIn',
Â  Â  Â  Â  Â  delay: idx * 20, 
Â  Â  Â  Â  Â  onComplete: function(){
Â  Â  Â  Â  Â  Â  item.destroy();
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  Â  });
Â  Â  Â  this.oldLetters = []; 
Â  Â  }
Â  }

Â  generateAnimatedText(text, options = { instant: false }){
Â  Â  if(!text) return;

Â  Â  // 1. DÃ©placer et dÃ©truire l'ancien texte
Â  Â  if(this.letters.length > 0){
Â  Â  Â  this.oldLetters = this.letters;
Â  Â  Â  if(!options.instant){
Â  Â  Â  Â  this.animateOldTextOut();
Â  Â  Â  } else {
Â  Â  Â  Â  // Destruction immÃ©diate (pour changement de thÃ¨me/vitesse)
Â  Â  Â  Â  this.oldLetters.forEach(function(l){
Â  Â  Â  Â  Â  self.tweens.killTweensOf(l); // ArrÃªter les tweens continus
Â  Â  Â  Â  Â  l.destroy();
Â  Â  Â  Â  });
Â  Â  Â  Â  this.oldLetters = [];
Â  Â  Â  }
Â  Â  }
Â  Â  
Â  Â  this.letters=[]; 

Â  Â  var config = this.colorConfigs[this.currentTheme];
Â  Â  var style = { ...config.style, fontSize:'40px' }; 
Â  Â  var bgColor = Phaser.Display.Color.HexStringToColor('#b8ffb8').color; 

Â  Â  var gameWidth = this.cameras.main.width;
Â  Â  var centerY = this.cameras.main.height / 2;
Â  Â Â 
Â  Â  var charWidth = 45; 
Â  Â  var totalWidth = text.length * charWidth;
Â  Â  var centerX = this.cameras.main.width / 2;
Â  Â  var targetStartX = centerX - totalWidth / 2 + charWidth/2;
Â  Â Â 
Â  Â  var self = this;
Â  Â  for(var i=0;i<text.length;i++){
Â  Â  Â  (function(self,ch,idx){
Â  Â  Â  Â  var targetX = targetStartX + idx * charWidth;
Â  Â  Â  Â  var startX = options.instant ? targetX : -50; 
Â  Â  Â  Â Â 
Â  Â  Â  Â  // CrÃ©er le cercle de fond
Â  Â  Â  Â  var bgCircle = self.add.circle(startX, centerY, 35, bgColor, 0.8).setDepth(99).setStrokeStyle(3, config.hex, 1);
Â  Â  Â  Â  self.letters.push(bgCircle);
Â  Â  Â  Â Â 
Â  Â  Â  Â  // CrÃ©er le texte
Â  Â  Â  Â  var letter=self.add.text(startX, centerY, ch, style).setOrigin(0.5).setDepth(100);
Â  Â  Â  Â  self.letters.push(letter);
Â  Â  Â  Â  
Â  Â  Â  Â  var baseDelay = 100;
Â  Â  Â  Â  var indexDelay = idx * 30;

Â  Â  Â  Â  if(!options.instant){
Â  Â  Â  Â  Â  // Animation d'entrÃ©e (GAUCHE -> CENTRE)
Â  Â  Â  Â  Â  self.tweens.add({
Â  Â  Â  Â  Â  Â  targets: [bgCircle, letter],
Â  Â  Â  Â  Â  Â  x: targetX,
Â  Â  Â  Â  Â  Â  duration: 350, 
Â  Â  Â  Â  Â  Â  ease: 'Quad.easeOut', 
Â  Â  Â  Â  Â  Â  delay: baseDelay + indexDelay,
Â  Â  Â  Â  Â  Â  onComplete: function(){
Â  Â  Â  Â  Â  Â  Â  self.addContinuousFloatAnimation(bgCircle, letter, targetX, centerY, config.shapeIndex, idx);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  // Animation de zoom au dÃ©but de l'entrÃ©e
Â  Â  Â  Â  Â  bgCircle.setScale(0.5);
Â  Â  Â  Â  Â  letter.setScale(0.5);
Â  Â  Â  Â  Â  self.tweens.add({
Â  Â  Â  Â  Â  Â  targets: [bgCircle, letter],
Â  Â  Â  Â  Â  Â  scale: 1, 
Â  Â  Â  Â  Â  Â  duration: 350,
Â  Â  Â  Â  Â  Â  ease: 'Quad.easeOut',
Â  Â  Â  Â  Â  Â  delay: baseDelay + indexDelay,
Â  Â  Â  Â  Â  });
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  // Mode instantanÃ© (changement de thÃ¨me/vitesse)
Â  Â  Â  Â  Â  bgCircle.x = targetX;
Â  Â  Â  Â  Â  letter.x = targetX;
Â  Â  Â  Â  Â  self.addContinuousFloatAnimation(bgCircle, letter, targetX, centerY, config.shapeIndex, idx);
Â  Â  Â  Â  }
Â  Â  Â  })(this,text[i],i);
Â  Â  }
Â  }
Â  
Â  addContinuousFloatAnimation(bgCircle, letter, targetX, centerY, shapeIndex, idx){
Â  Â  // ArrÃªte les tweens continus prÃ©cÃ©dents pour Ã©viter les conflits
Â  Â  this.tweens.killTweensOf([bgCircle, letter]);

Â  Â  switch(shapeIndex){
Â  Â  Â  case 0: // Pink: gentle float
Â  Â  Â  Â  this.tweens.add({targets:bgCircle, y:centerY+8, duration:2000+idx*100, ease:"sine.inout", yoyo:true, repeat:-1});
Â  Â  Â  Â  this.tweens.add({targets:letter, y:centerY+8, duration:2000+idx*100, ease:"sine.inout", yoyo:true, repeat:-1});
Â  Â  Â  Â  break;
Â  Â  Â  case 1: // Blue: vertical spin
Â  Â  Â  Â  this.tweens.add({targets:bgCircle, y:centerY+15, angle:180, duration:1500, ease:"linear", yoyo:true, repeat:-1});
Â  Â  Â  Â  this.tweens.add({targets:letter, y:centerY+15, duration:1500, ease:"linear", yoyo:true, repeat:-1});
Â  Â  Â  Â  break;
Â  Â  Â  case 2: // Yellow: quick up-down
Â  Â  Â  Â  this.tweens.add({targets:bgCircle, y:centerY-5, duration:800, ease:"quad.inout", yoyo:true, repeat:-1});
Â  Â  Â  Â  this.tweens.add({targets:letter, y:centerY-5, duration:800, ease:"quad.inout", yoyo:true, repeat:-1});
Â  Â  Â  Â  break;
Â  Â  Â  case 3: // Green: side-to-side (text x,y remains centered)
Â  Â  Â  Â  this.tweens.add({targets:bgCircle, x:targetX+10, duration:1800, ease:"sine.inout", yoyo:true, repeat:-1});
Â  Â  Â  Â  this.tweens.add({targets:letter, x:targetX+10, duration:1800, ease:"sine.inout", yoyo:true, repeat:-1});
Â  Â  Â  Â  break;
Â  Â  Â  case 4: // Red: pulse scale
Â  Â  Â  Â  this.tweens.add({targets:bgCircle, scale:1.1, duration:500, ease:"sine.inout", yoyo:true, repeat:-1});
Â  Â  Â  Â  this.tweens.add({targets:letter, angle:-360, duration:2000, ease:"linear", repeat:-1});
Â  Â  Â  Â  break;
Â  Â  }
Â  }

Â  clearAnimatedText(){
Â  Â  if(this.letters){
Â  Â  Â  this.oldLetters = this.letters;
Â  Â  Â  this.letters = [];
Â  Â  Â  this.animateOldTextOut(); 
Â  Â  }
Â  }

Â  createTextEngine(){
Â  Â  var input=document.getElementById("text-input");
Â  Â  var button=document.getElementById("generate-btn");
Â  Â  var randomBtn = document.getElementById("random-btn"); 
Â  Â  var exportBtn = document.getElementById("export-btn"); 
Â  Â  var clearBtn=document.getElementById("clear-history-btn");
Â  Â  var self=this;

Â  Â  button.addEventListener("click", function(){
Â  Â  Â  var text=input.value.toUpperCase().trim();
Â  Â  Â  self.processGeneration(text);
Â  Â  Â  input.value = '';
Â  Â  });
Â  Â  
Â  Â  randomBtn.addEventListener("click", function(){ 
Â  Â  Â  self.generateRandom();
Â  Â  });

Â  Â  exportBtn.addEventListener("click", function(){ 
Â  Â  Â  self.exportImage();
Â  Â  });

Â  Â  input.addEventListener('keypress', function(e){
Â  Â  Â  if(e.key === 'Enter'){
Â  Â  Â  Â  button.click();
Â  Â  Â  }
Â  Â  });

Â  Â  clearBtn.addEventListener("click", function(){
Â  Â  Â  self.history = [];
Â  Â  Â  self.updateHistoryUI();
Â  Â  Â  self.clearAnimatedText();
Â  Â  Â  self.currentAnimationText = '';
Â  Â  });
Â  }

Â  processGeneration(text){
Â  Â  if(!text) return;

Â  Â  // Stocke la configuration actuelle de l'animation dans l'historique
Â  Â  var historyItem = { 
Â  Â  Â  text: text, 
Â  Â  Â  color: this.currentTheme,
Â  Â  Â  speed: this.speed,
Â  Â  Â  amplitude: this.amplitude
Â  Â  };
Â  Â  var alreadyInHistory = this.history.some(item => item.text === text);
Â  Â  if(!alreadyInHistory){
Â  Â  Â  this.history.push(historyItem);
Â  Â  }
Â  Â  this.updateHistoryUI();
Â  Â Â 
Â  Â  // GÃ©nÃ©rer l'animation avec l'effet de transition GAUCHE -> DROITE
Â  Â  this.generateAnimatedText(text);
Â  Â  this.currentAnimationText = text;
Â  Â Â 
Â  Â  this.playSoundOnce();
Â  }

Â  generateRandom(){
Â  Â  var keys = Object.keys(this.colorConfigs);
Â  Â  var randomColor = keys[Phaser.Math.RND.between(0, keys.length - 1)];
Â  Â  
Â  Â  var randomText = this.funnyTexts[Phaser.Math.RND.between(0, this.funnyTexts.length - 1)];
Â  Â  
Â  Â  // GÃ©nÃ©rer des valeurs d'animation alÃ©atoires dans la plage des curseurs
Â  Â  this.speed = Phaser.Math.RND.between(100, 500);
Â  Â  this.amplitude = Phaser.Math.RND.between(5, 40);

Â  Â  // Appliquer le thÃ¨me (met Ã  jour les curseurs et l'UI)
Â  Â  // Note: regenerateText est false ici car processGeneration sera appelÃ© juste aprÃ¨s
Â  Â  this.applyTheme(randomColor, { updateControls: true, regenerateText: false });

Â  Â  // ExÃ©cuter la gÃ©nÃ©ration (qui appellera generateAnimatedText)
Â  Â  this.processGeneration(randomText);
Â  }

Â  updateHistoryUI(){
Â  Â  var historyList=document.getElementById("history-list");
Â  Â  historyList.innerHTML = '';
Â  Â  var self = this;
Â  Â  var currentText = self.currentAnimationText;
Â  Â  var currentTheme = self.currentTheme;

Â  Â  this.history.forEach(function(item){
Â  Â  Â  var itemText = item.text;
Â  Â  Â  var itemColor = item.color;
Â  Â  Â  
Â  Â  Â  var element = document.createElement('div');
Â  Â  Â  element.className = 'history-item';
Â  Â  Â  
Â  Â  Â  // VÃ©rifie si la couleur et le texte correspondent au thÃ¨me/texte actuel + les contrÃ´les
Â  Â  Â  if(itemText === currentText && itemColor === currentTheme && item.speed === self.speed && item.amplitude === self.amplitude){
Â  Â  Â  Â  element.classList.add('active');
Â  Â  Â  Â  element.style.backgroundColor = self.colorConfigs[itemColor].style.color;
Â  Â  Â  Â  element.style.borderColor = self.colorConfigs[itemColor].style.color;
Â  Â  Â  Â  element.style.color = 'white';
Â  Â  Â  } else {
Â  Â  Â  Â  element.style.backgroundColor = '';
Â  Â  Â  Â  element.style.borderColor = 'rgba(255, 62, 181, 0.2)';
Â  Â  Â  Â  element.style.color = '#333';
Â  Â  Â  }
Â  Â  Â  element.textContent = `${itemText} (${itemColor}, Sp:${item.speed}, Amp:${item.amplitude})`;
Â  Â  Â Â 
Â  Â  Â  element.addEventListener('click', function(){
Â  Â  Â  Â  // Appliquer les paramÃ¨tres de l'historique
Â  Â  Â  Â  self.speed = item.speed;
Â  Â  Â  Â  self.amplitude = item.amplitude;
Â  Â  Â  Â  self.applyTheme(itemColor, { updateControls: true, regenerateText: false }); 
Â  Â  Â  Â  self.processGeneration(itemText);
Â  Â  Â  });

Â  Â  Â  historyList.appendChild(element);
Â  Â  });
Â  }

Â  clearAnimatedText(){
Â  Â  if(this.letters){
Â  Â  Â  this.oldLetters = this.letters;
Â  Â  Â  this.letters = [];
Â  Â  Â  this.animateOldTextOut(); 
Â  Â  }
Â  }

Â  exportImage(){
Â  Â  var self = this;
Â  Â  
Â  Â  self.game.renderer.snapshot(function(image){
Â  Â  Â  var link = document.createElement('a');
Â  Â  Â  link.download = 'PhaserAnimation_' + new Date().getTime() + '.png';
Â  Â  Â  link.href = image.src;
Â  Â  Â  document.body.appendChild(link);
Â  Â  Â  link.click();
Â  Â  Â  document.body.removeChild(link);
Â  Â  });
Â  }

Â  setupAudio(){
Â  Â  var self = this;
Â  Â  try {
Â  Â  Â  this.popSound = this.sound.add('pop', { loop: false, volume: 0.5 });
Â  Â  } catch(e){
Â  Â  Â  console.log('Audio setup skipped');
Â  Â  }
Â  }

Â  playSoundOnce(){
Â  Â  if(this.popSound){
Â  Â  Â  try {
Â  Â  Â  Â  this.popSound.stop();
Â  Â  Â  Â  this.popSound.play();
Â  Â  Â  } catch(e){
Â  Â  Â  Â  console.log('Sound play error');
Â  Â  Â  }
Â  Â  }
Â  }

Â  setupMouseFleeEffect(){
Â  Â  var self = this;
Â  Â  this.input.on('pointermove', function(pointer){
Â  Â  Â  if(!self.blocks) return;

Â  Â  Â  self.blocks.getChildren().forEach(function(block){
Â  Â  Â  Â  var angle = Phaser.Math.Angle.Between(block.x, block.y, pointer.x, pointer.y);
Â  Â  Â  Â  var distance = Phaser.Math.Distance.Between(block.x, block.y, pointer.x, pointer.y);
Â  Â  Â  Â Â 
Â  Â  Â  Â  if(distance < 1000){
Â  Â  Â  Â  Â  var fleeForce = (1000 - distance) / 100000 * 6000;
Â  Â  Â  Â  Â  block.x += Math.cos(angle + Math.PI) * fleeForce;
Â  Â  Â  Â  Â  block.y += Math.sin(angle + Math.PI) * fleeForce;
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  });
Â  }
}

var config = { type: Phaser.AUTO, width: window.innerWidth*0.70, height: window.innerHeight, backgroundColor:'#b8ffb8', parent:'phaser-example', scene:Example, render: { antialias: true, powerPreference: "high-performance" } };
new Phaser.Game(config);
</script>

</body>
</html>
